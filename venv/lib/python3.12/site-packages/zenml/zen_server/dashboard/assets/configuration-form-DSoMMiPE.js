import{j as e,r as k}from"./@radix-Cdvw4jJ8.js";import{f as I,i as L,F as Q,j as B,as as X,au as H,av as ee,aw as se,aO as re,g as R,W as te,X as ae,am as ne,Y as oe,Z as ie,_ as le,I as $,$ as ce,a0 as me,a1 as q,a2 as N,h as de,bq as ue,b as pe,L as xe,B as C,H as he,z as v,e as fe,a as je,ar as ge,J as ye}from"./index-BgEfQ3_G.js";import{c as M,j as Ne,b as Ce,h as ve}from"./@tanstack-5gTMR7G2.js";import{f as be}from"./index-eoDB_1XX.js";import{g as we,a as Se,D as Fe,b as _e}from"./form-BgtamtJm.js";import{t as ze}from"./zod-XdS2h1ws.js";import{a as Pe,C as Te,u as Ee,F as Oe}from"./index.esm-DhJo3mA6.js";import{S as Ae}from"./transform-CeZdrxDZ.js";import{S as ke}from"./check-B9QMTa3f.js";import{S as qe}from"./plus-Cl0_rCVF.js";import{C as De}from"./CodeSnippet-Ctplhzdc.js";import{S as Ie}from"./file-text-Cd8wVfq5.js";import{S as Le}from"./terminal-square-XFL_4QN-.js";import{C as Qe}from"./ComponentIcon-CMiVW-O6.js";async function Be({payload:s}){const r=L(B.components.all),t=await I(r,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(s)});if(!t.ok){const o=await t.json().then(l=>Array.isArray(l.detail)?l.detail[1]:l.detail).catch(()=>"Error while creating new stack");throw new Q({status:t.status,statusText:t.statusText,message:o})}return t.json()}function Re(s){return M({...s,mutationFn:async({payload:r})=>Be({payload:r})})}function $e({open:s,setOpen:r}){return e.jsx(X,{open:s,onOpenChange:r,children:e.jsxs(H,{className:"max-w-[600px]",children:[e.jsx(ee,{children:e.jsx(se,{children:"Create Service Connector"})}),e.jsx("div",{className:"min-w-0 p-5",children:e.jsxs("div",{className:"min-w-0 max-w-full space-y-1",children:[e.jsx("p",{children:"Create a new service connector"}),e.jsx(De,{wrap:!0,code:"zenml service-connector register <NAME> --type=<TYPE> --interactive"})]})})]})})}function Me({connectorResourceType:s}){var h;const r=Pe(),[t,o]=k.useState(!1),[l,p]=k.useState(!1),x=Ne(re.serviceConnectorListInfinite({resource_type:s,sort_by:"desc:created"}));if(x.isPending)return e.jsx(R,{className:"h-[60px] w-full"});if(x.isError)return e.jsx("div",{children:"Error"});const m=(h=x.data)==null?void 0:h.pages.flatMap(a=>a.items);return e.jsxs(e.Fragment,{children:[e.jsx(Te,{control:r.control,name:"connector",render:({field:a})=>e.jsxs(te,{modal:!0,open:t,onOpenChange:o,children:[e.jsx(ae,{asChild:!0,children:e.jsx("button",{className:ne("w-full flex-1 truncate rounded-md border border-primary-400 bg-theme-surface-secondary px-2",{"h-7":!a.value,"py-2 pl-2 pr-3 text-left":a.value}),children:a.value?(()=>{const i=m.find(d=>d.id===a.value);return i?e.jsx(D,{connector:i}):"Select Connector"})():"Select Connector"})}),e.jsx(oe,{className:"p-0",style:{width:"var(--radix-popover-trigger-width)"},align:"start",children:e.jsxs(ie,{filter:(i,d)=>i.toLowerCase().includes(d.toLowerCase())||i.includes("doNotFilter-")?1:0,children:[m.length>0&&e.jsx(le,{placeholder:"Search connectors...",children:e.jsx($,{className:"w-full",inputSize:"sm"})}),e.jsx(ce,{className:"space-y-1 p-2",children:e.jsxs("div",{className:"space-y-1",children:[m.length>0?e.jsxs(e.Fragment,{children:[e.jsx(me,{children:"No results"}),e.jsx(q,{className:"max-h-[300px] overflow-y-auto",children:m.map(i=>e.jsxs(N,{value:`${i.id}:${i.name}`,onSelect:d=>{const[f]=d.split(":");r.setValue("connector",a.value===f?"":f),o(!1)},children:[e.jsx(D,{connector:i}),e.jsx(ke,{className:de("fill-brand-500 ml-auto size-4 shrink-0",a.value===i.id?"opacity-100":"opacity-0")})]},i.id))})]}):e.jsx("div",{className:"p-2 text-center text-theme-text-secondary",children:"No connectors found"}),e.jsx(ue,{className:"-mx-1"}),e.jsxs(q,{children:[x.hasNextPage&&e.jsx(N,{value:"doNotFilter-fetch-more",className:"flex items-center font-semibold",onSelect:()=>{x.fetchNextPage()},children:"Load more"}),e.jsxs(N,{value:"doNotFilter-create-new",className:"flex items-center gap-2 font-semibold",onSelect:()=>{o(!1),p(!0)},children:[e.jsx(qe,{className:"size-3 shrink-0 fill-neutral-400"}),"Create new Service Connector"]})]})]})})]})})]})}),e.jsx($e,{open:l,setOpen:p})]})}function D({connector:s}){var r,t;return e.jsxs("div",{className:"flex items-center gap-2",children:[typeof((r=s.body)==null?void 0:r.connector_type)=="object"&&((t=s.body)==null?void 0:t.connector_type.logo_url)&&e.jsx("img",{src:s.body.connector_type.logo_url,alt:s.name,className:"size-5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-theme-text-secondary",children:s.id.split("-")[0]})]})]})}function Ue({connectorResourceType:s}){return e.jsxs("section",{className:"w-full max-w-full space-y-3 overflow-x-hidden rounded-md border border-warning-50 bg-[#FFF6EA] p-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"size-5 shrink-0 fill-warning-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Connect to resource"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"You can select a Service Connector to connect ZenML to external resources"})]}),e.jsx(Me,{connectorResourceType:s})]})}function Ve({sdkDocsUrl:s,name:r,logoUrl:t,type:o}){return e.jsxs(pe,{className:"space-y-5 overflow-hidden pb-5",children:[e.jsx("div",{className:"flex h-[120px] w-full items-center justify-center bg-teal-25",children:t?e.jsx("img",{width:60,height:60,className:"aspect-square object-contain",src:xe(t),alt:`Logo of ${r}`}):e.jsx(Qe,{className:"aspect-square h-[60px] w-[60px] fill-primary-400 object-contain",type:o})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"px-5",children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Need Help?"}),e.jsx("p",{className:"text-theme-text-secondary",children:"Follow our extensive documentation to get started."})]}),e.jsxs("ul",{className:"space-y-0.5 px-5",children:[!!s&&e.jsx("li",{children:e.jsx(C,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:s,children:[e.jsx(Ie,{className:"size-5 shrink-0 fill-primary-600"}),"Api Reference"]})})}),e.jsx("li",{children:e.jsx(C,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:"https://github.com/zenml-io/zenml/tree/main/examples",children:[e.jsx(Le,{className:"size-5 shrink-0 fill-primary-600"}),"Navigate our examples"]})})}),e.jsx("li",{children:e.jsx(C,{asChild:!0,emphasis:"minimal",intent:"primary",size:"md",children:e.jsxs("a",{className:"flex items-center gap-1",target:"_blank",rel:"noopener noreferrer",href:"https://www.zenml.io/blog",children:[e.jsx(he,{className:"size-5 shrink-0 fill-primary-600"}),"Read our blog"]})})})]})]})]})}const Je=v.object({componentName:v.string().min(1,"Component name is required"),connector:v.string()});async function Ke({componentId:s,payload:r}){const t=L(B.components.detail(s)),o=await I(t,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(r)});if(!o.ok){const l=await o.json().then(p=>Array.isArray(p.detail)?p.detail[1]:p.detail).catch(()=>"Error while creating new stack");throw new Q({status:o.status,statusText:o.statusText,message:l})}return o.json()}function Ye(s){return M({...s,mutationFn:async({payload:r,componentId:t})=>Ke({payload:r,componentId:t})})}function ms({flavorId:s,formId:r,successHandler:t,FooterComponent:o,useMaxHeight:l=!1,component:p,isCreate:x=!0}){var a,i,d,f;const m=Ce(be.flavorDetail(s)),h=fe();return m.isPending||h.isPending?e.jsx("div",{className:"px-8 py-5",children:e.jsx(R,{className:"h-[250px] w-full"})}):m.isError||h.isError?e.jsx("p",{className:"px-8 py-5",children:"Failed to fetch flavor"}):e.jsx(Ze,{isCreate:x,component:p,useMaxHeight:l,infoTile:e.jsx(Ve,{type:((a=m.data.body)==null?void 0:a.type)||"orchestrator",name:m.data.name,sdkDocsUrl:((i=m.data.metadata)==null?void 0:i.sdk_docs_url)??void 0,logoUrl:((d=m.data.body)==null?void 0:d.logo_url)??void 0}),FooterComponent:o,successHandler:t,flavor:m.data,userId:h.data.id,formId:r,schema:(f=m.data.metadata)==null?void 0:f.config_schema})}function Ze({formId:s,schema:r,flavor:t,userId:o,successHandler:l,infoTile:p,FooterComponent:x,useMaxHeight:m,isCreate:h,component:a}){var S,F,_,z,P;const{toast:i}=je(),d=ye.all,f=ve(),b=Re({onSuccess:({id:n})=>{f.invalidateQueries({queryKey:d}),l==null||l(n)},onError:n=>{i({emphasis:"subtle",status:"error",rounded:!0,description:n.message})}}),U=Ye({onSuccess:({id:n})=>{f.invalidateQueries({queryKey:d}),l==null||l(n)},onError:n=>{i({emphasis:"subtle",status:"error",rounded:!0,description:n.message})}}),V=r.properties||{},g=r.required||[],J=r.$defs;function K({componentName:n,...c}){var E,O,A;if(Object.keys(c).forEach(u=>{(c[u]===""||c[u]===null||c[u]===void 0||Array.isArray(c[u])&&c[u].length===0||typeof c[u]=="object"&&!Array.isArray(c[u])&&Object.keys(c[u]).length===0)&&delete c[u]}),!t.body)return;const{connector:y,...T}=c;if(h)b.mutate({payload:{name:n,configuration:T,flavor:t.name,type:t.body.type,user:o,connector:y||null}});else{if(!a)return;const u=((O=(E=a.metadata)==null?void 0:E.connector)==null?void 0:O.id)!==y,W=(A=a.metadata)==null?void 0:A.connector_resource_id;U.mutate({componentId:a.id,payload:{...!u&&{connector_resource_id:W},name:n,configuration:T,connector:y||null}})}}const Y=Je.merge(we(r)),Z=Se(r,(S=a==null?void 0:a.metadata)==null?void 0:S.configuration),j=Ee({resolver:ze(Y),defaultValues:{componentName:(a==null?void 0:a.name)??"",connector:((_=(F=a==null?void 0:a.metadata)==null?void 0:F.connector)==null?void 0:_.id)??"",...Z}}),{handleSubmit:G}=j,w=Object.entries(V).sort(([n],[c])=>g.includes(n)&&!g.includes(c)?-1:!g.includes(n)&&g.includes(c)?1:0);return e.jsx(Oe,{...j,children:e.jsxs("form",{onSubmit:n=>(n.stopPropagation(),G(K)(n)),id:s,children:[e.jsx(ge,{viewportClassName:m?"max-h-[70vh]":"",children:e.jsxs("div",{className:"space-y-4 p-8",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"text-text-lg font-semibold",children:"Component Name"}),e.jsx($,{...j.register("componentName"),"data-error":j.formState.errors.componentName?"true":"false",className:"w-full data-[error=true]:border-error-500",inputSize:"lg"}),j.formState.errors.componentName&&e.jsx("p",{className:"text-text-sm text-error-500",children:(z=j.formState.errors.componentName.message)==null?void 0:z.toString()})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-5 xl:flex-row",children:[e.jsxs("div",{className:"flex-1 space-y-5",children:[(P=t.metadata)!=null&&P.connector_resource_type?e.jsx(Ue,{connectorResourceType:t.metadata.connector_resource_type}):null,w.length>0?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-text-lg font-semibold",children:"Attributes"}),w.map(([n,c])=>e.jsx(Fe,{definitions:J,isOptional:_e(n,g),name:n,schema:c},n))]}):null]}),e.jsx("div",{className:"w-full xl:w-1/3",children:p})]})]})}),e.jsx(x,{formId:s,isPending:b.isPending})]})})}export{ms as C};
