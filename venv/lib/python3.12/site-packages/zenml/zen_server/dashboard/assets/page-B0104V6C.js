import{r as c,j as e}from"./@radix-Cdvw4jJ8.js";import{c as A,u as _}from"./bulk-delete-CzYA--cC.js";import{q as E,c as O,b as I}from"./@tanstack-5gTMR7G2.js";import{i as C,j as w,o as F,f as B,n as L,F as y,A as q,k as z,B as P,D as $,l as M,m as G,p as H,C as g,r as p,T as U,q as K,s as Q,t as J,v as j,w as V,z as d,x as W,g as D}from"./index-BgEfQ3_G.js";import{S as X}from"./refresh-BcTM09NW.js";import{P as Y}from"./Pagination-CWnEpSpN.js";import{S as Z}from"./SearchField-BtUi6cYl.js";import{S}from"./trash-DP6Tpp_E.js";import{D as v,a as T}from"./DeleteAlertDialog-DEI0YDzP.js";import{S as ee}from"./pipeline-CSUlkd50.js";import{S as te}from"./terminal-XFL_4QN-.js";import{g as se,E as ne,a as ae}from"./ExecutionStatus-BuhNAE9w.js";import{L as m,f as ie}from"./@react-router-DeDfXbUF.js";import{A as re}from"./AlertDialogDropdownItem-DsOmO1FH.js";import"./@reactflow-B_iCtR7X.js";import"./chevron-right-double-Dgp_gEsp.js";import"./index-DWpiv-Ft.js";import"./zod-XdS2h1ws.js";import"./index.esm-DhJo3mA6.js";import"./check-circle-C4tYvbtw.js";import"./help-Co6aedki.js";async function oe({params:t}){const n=C(w.pipelines.all+"?"+F(t)),s=await B(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&L(),!s.ok)throw new y({message:"Error while fetching pipelines",status:s.status,statusText:s.statusText});return s.json()}const x={all:["pipelines"],pipelineList:t=>E({queryKey:[...x.all,t],queryFn:async()=>oe({params:t})})};async function le({pipelineId:t}){const n=C(w.pipelines.detail(t)),s=await fetch(n,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!s.ok){const a=await s.json().then(i=>i.detail).catch(()=>`Failed to delete pipeline ${t}`);throw new y({status:s.status,statusText:s.statusText,message:a})}return s.json()}function ce(t){return O({mutationFn:le,...t})}const{ContextProvider:de,useContext:u}=A();function b(){const{setRowSelection:t}=u(),{mutateAsync:n}=ce();async function s(a){await n({pipelineId:a})}return _({deleteFn:s,queryKeyToInvalidate:x.all,setRowSelection:t})}function ue(){const[t,n]=c.useState(!1),{selectedRowCount:s,selectedRowIDs:a}=u(),{bulkDelete:i}=b();async function r(){await i(a),n(!1)}return e.jsxs(q,{open:t,onOpenChange:n,children:[e.jsx(z,{asChild:!0,children:e.jsxs(P,{className:"rounded-sharp border-y-0 bg-white",size:"md",emphasis:"subtle",intent:"secondary",children:[e.jsx(S,{className:"h-5 w-5 shrink-0 gap-1 fill-neutral-400"}),"Delete"]})}),e.jsx(v,{title:`Delete Pipeline${s>=2?"s":""}`,handleDelete:r,children:e.jsxs(T,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})]})}function pe(){const{selectedRowCount:t}=u();return e.jsxs("div",{className:"flex items-center divide-x divide-theme-border-moderate overflow-hidden rounded-md border border-theme-border-moderate",children:[e.jsx("div",{className:"bg-primary-25 px-2 py-1 font-semibold text-theme-text-brand",children:`${t} Pipeline${t>1?"s":""} selected`}),e.jsx(ue,{})]})}function me({id:t}){const[n,s]=c.useState(!1),[a,i]=c.useState(!1),r=c.useRef(null),o=c.useRef(null),{bulkDelete:N}=b();async function R(){await N([t]),f(!1)}function k(){o.current=r.current}function f(l){if(l===!1){i(!1),setTimeout(()=>{s(l)},200);return}s(l)}return e.jsxs($,{onOpenChange:i,open:a,children:[e.jsx(M,{ref:r,children:e.jsx(G,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsx(H,{hidden:n,onCloseAutoFocus:l=>{o.current&&(o.current.focus(),o.current=null,l.preventDefault())},align:"end",sideOffset:7,children:e.jsx(re,{onSelect:k,open:n,onOpenChange:f,triggerChildren:"Delete",icon:e.jsx(S,{fill:"red"}),children:e.jsx(v,{title:"Delete Pipeline",handleDelete:R,children:e.jsxs(T,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})})]})}function he(){return[{id:"select",meta:{width:"1%"},header:({table:t})=>e.jsx(g,{id:"check-all",checked:t.getIsAllRowsSelected(),onCheckedChange:n=>t.toggleAllRowsSelected(n==="indeterminate"?!0:n)}),cell:({row:t})=>e.jsx(g,{id:`check-${t.id}`,checked:t.getIsSelected(),onCheckedChange:t.getToggleSelectedHandler()})},{id:"name",header:"Pipeline",cell:({row:t})=>{var n,s,a;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[e.jsx(ee,{className:`h-5 w-5 ${se((n=t.original.resources)==null?void 0:n.latest_run_status)}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{to:p.projects.pipelines.namespace(encodeURIComponent(t.original.name)),className:"flex items-center gap-1",children:e.jsx("span",{className:"text-text-md font-semibold text-theme-text-primary",children:t.original.name})}),e.jsx(U,{children:e.jsxs(K,{children:[e.jsx(Q,{className:"hover:text-theme-text-brand hover:underline",children:e.jsx(ne,{status:(s=t.original.resources)==null?void 0:s.latest_run_status})}),e.jsx(J,{className:"z-20 capitalize",children:(a=t.original.resources)==null?void 0:a.latest_run_status})]})}),e.jsx(j,{copyText:t.original.name})]}),e.jsxs(m,{to:p.projects.pipelines.namespace(encodeURIComponent(t.original.name)),className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:t.original.id.split("-")[0]}),e.jsx(j,{copyText:t.original.id})]})]})]})}},{id:"latest-run",header:"Latest Run",accessorFn:t=>{var n,s;return{status:(n=t.resources)==null?void 0:n.latest_run_status,runId:(s=t.resources)==null?void 0:s.latest_run_id}},cell:({getValue:t})=>{const{runId:n,status:s}=t();return!n||!s?e.jsx("div",{children:"No run"}):e.jsx(m,{to:p.projects.runs.detail(n),children:e.jsxs(V,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:ae(s),children:[e.jsx(te,{className:"h-3 w-3 fill-current"}),n==null?void 0:n.split("-")[0]]})})}},{id:"admin_actions",header:"",meta:{width:"5%"},cell:({row:t})=>e.jsx(me,{id:t.original.id})}]}const h=1,xe=d.object({page:d.coerce.number().min(h).optional().default(h).catch(h),name:d.string().optional(),operator:d.enum(["and","or"]).optional()});function fe(){const[t]=ie(),{page:n,name:s,operator:a}=xe.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:n,name:s,logical_operator:a}}function ge(){const t=fe(),{selectedRowCount:n,rowSelection:s,setRowSelection:a}=u(),{data:i,refetch:r}=I({...x.pipelineList({...t,sort_by:"desc:latest_run"}),throwOnError:!0});return e.jsxs("div",{className:"flex flex-col gap-5 pt-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[n?e.jsx(pe,{}):e.jsx(Z,{searchParams:t}),e.jsx("div",{className:"flex justify-between",children:e.jsxs(P,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>r(),children:[e.jsx(X,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:i?e.jsx(W,{rowSelection:s,onRowSelectionChange:a,getRowId:o=>o.id,columns:he(),data:i.items}):e.jsx(D,{className:"h-[500px] w-full"})}),i?i.total_pages>1&&e.jsx(Y,{searchParams:t,paginate:i}):e.jsx(D,{className:"h-[36px] w-[300px]"})]})]})}function qe(){return e.jsx(de,{children:e.jsx(ge,{})})}export{qe as default};
